import{t,p,m,u,h,w,q}from"./common.js";async function Ya(a){return new Promise((b,d)=>{t(a,b,d)})}const Za=chrome.storage.sync;async function $a(){return(await Ya(p(m(new u(Za),{VER:!0})))).VER}async function ab(){const a=await $a();h(a)||!/^\d+\.\d+\.\d+$/.test(a)?Z("1.0.0"):0>bb(a,chrome.runtime.getManifest().version)&&Z(a)}async function Z(a){function b(c){const e=new w("sync",c),f={};for(let [g,n]of Object.entries(d[c])){c=g;let l=n;(!a||0<bb(c,a))&&Object.assign(f,l)}c={};for(let g in f)c[e.i(g)]=
f[g];t(q(m(new u(e.g),c)))}const d=await (await fetch("/assets/default_exclusions.json")).json();b("JS2.");b("CSS.");await Ya(q(m(new u(Za),{VER:chrome.runtime.getManifest().version})))}function bb(a,b){a=a.split(".").map(cb);b=b.split(".").map(cb);return a[0]>b[0]?1:a[0]<b[0]?-1:a[1]>b[1]?1:a[1]<b[1]?-1:a[2]>b[2]?1:a[2]<b[2]?-1:0}function cb(a){return parseInt(a,10)}chrome.runtime.onInstalled.addListener(async a=>{"install"!==a.reason&&"update"!==a.reason||await Z(a.previousVersion)});chrome.runtime.onMessage.addListener(a=>
{2===a.type&&ab()});chrome.runtime.onMessage.addListener((a,b)=>{const d=b.tab?b.tab.id:a.data,c={file:"assets/user-select.css",cssOrigin:"user"};b.tab?c.frameId=b.frameId:c.allFrames=!0;switch(a.type){case 0:c.runAt="document_start";chrome.tabs.insertCSS(d,c);break;case 1:chrome.tabs.removeCSS(d,c)}});
// Copyright 2021-2022, Sean Lee <i73hi64d0wr5df8pckig@gmail.com>. All rights reserved.